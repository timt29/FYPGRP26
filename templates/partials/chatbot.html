<div id="chatbot-button" onclick="toggleChatbot()">
  <img src="/static/img/FAQ-robot.png" alt="Chatbot" />
</div>

<div id="chatbot-popup">
  <div id="chatbot-header">
    EchoBot
    <span id="chatbot-close" onclick="toggleChatbot()">&times;</span>
  </div>
  <div id="chatbot-messages"></div>
  <div id="chatbot-input">
    <input type="text" id="userMessage" placeholder="Ask me anything.." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
function toggleChatbot() {
  const popup = document.getElementById("chatbot-popup");
  const input = document.getElementById("userMessage");
  if (popup.style.display === "block") {
    popup.style.display = "none";
  } else {
    popup.style.display = "block";
    input.focus();
  }
}

async function sendMessage() {
  const input = document.getElementById("userMessage");
  const message = input.value.trim();
  if (!message) return;

  const chatBox = document.getElementById("chatbot-messages");
  chatBox.innerHTML += `<p class="user"><b>You:</b> ${message}</p>`;

  const response = await fetch("/chat", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ message })
  });

  const data = await response.json();
  chatBox.innerHTML += `<p class="bot"><b>EchoBot:</b> ${data.response}</p>`;
  chatBox.scrollTop = chatBox.scrollHeight;
  input.value = "";
}

document.addEventListener("DOMContentLoaded", function() {
  const input = document.getElementById("userMessage");
  input.addEventListener("keypress", function (event) {
    if (event.key == "Enter") {
      event.preventDefault();
      sendMessage();
    }
  });
});
</script>
