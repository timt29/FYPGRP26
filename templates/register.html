<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Register - EchoPress</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/register.css') }}" />
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}" type="image/png" />
</head>

<body>
  <!-- Header -->
  <header class="header">
      <!-- 1) Logo image + EchoPress text -->
      <a href="{{ url_for('index') }}" class="logo">
        <img
          src="{{ url_for('static', filename='img/EchoPressLogo.png') }}"
          alt="EchoPress logo"
          class="logo-img"
        />
        <span>EchoPress</span>
      </a>

      <!-- Auth buttons stay on the far right -->
      <div class="auth-buttons">
        <a href="{{ url_for('login') }}" class="signin">Sign in</a>
      </div>
    </header>

  <!-- Content -->
  <div class="container">
    <!-- Left Welcome Section -->
    <div class="welcome">
      <h1>Welcome</h1>
      <p>
        to your publishing hub - where your voice drives conversations,
        your stories inspire change, and your presence shape the narrative.
        Register now and be part of our community!
      </p>
      <div class="social-icons">
        <a href="https://facebook.com" target="_blank">
          <img src="{{ url_for('static', filename='img/facebook.png') }}" alt="Facebook" />
        </a>
        <a href="https://x.com" target="_blank">
          <img src="{{ url_for('static', filename='img/x.png') }}" alt="X" />
        </a>
        <a href="https://instagram.com" target="_blank">
          <img src="{{ url_for('static', filename='img/instagram.png') }}" alt="Instagram" />
        </a>
        <a href="https://linkedin.com" target="_blank">
          <img src="{{ url_for('static', filename='img/linkedin.png') }}" alt="LinkedIn" />
        </a>
      </div>
    </div>

    <!-- Pre-Registration Modal -->
    <div id="preRegisterModal" class="pre-modal">
      <div class="pre-modal-content">
        <h1>Start your journey with EchoPress - read, write and connect today!</h1>
        <p>Join our growing community of readers and storytellers</p>
        <p>Start writing for free today!</p>

        <div class="role-cards">
          <!-- Non-registered Users -->
          <div class="role-card free-tier">
            <h2>Non-registered Users</h2>
            <p class="feature-heading">Features:</p>
            <ul>
              <li>Browse and read articles of your choices</li>
              <li>Share articles with your friends</li>
            </ul>
            <button class="join-btn" disabled>FREE</button>
          </div>

          <!-- Subscriber -->
          <div class="role-card highlight">
            <h2>Subscriber</h2>
            <button class="join-btn" id="subscriberBtn" onclick="selectRole('Subscriber')">Join for FREE!</button>
            <p class="feature-heading">Features:</p>
            <ul>
              <li>Publish your own stories and share your voice</li>
              <li>Comment and discuss with other readers</li>
              <li>Unlimited access to all articles</li>
              <li>Save and Bookmark your favorites for later</li>
              <li>Track your story performance and engagement</li>
              <li>No hidden fees - unsubscribe anytime</li>
            </ul>
          </div>

          <!-- Author -->
          <div class="role-card premium-tier">
            <div class="ribbon">Popular Choice</div>
            <h2>Author</h2>
            <p class="subscription-text">Become an Author now with just - <strong>$5/month</strong></p>
            <p class="feature-heading">Features:</p>
            <ul>
              <li>Subscriber features with additional features such as:</li>
              <li>Get Authenticated and Verified</li>
              <li>Publish your own articles to get featured at the top!</li>
            </ul>
            <button class="join-btn" id="authorBtn">UPGRADE</button>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Author Payment Modal -->
    <div id="authorModal" class="modal" aria-hidden="true">
      <div class="modal-content">
        <h2>Upgrade to Author</h2>
        <img src="/static/img/echopressPaynowQR.png" alt="QR Code">
        <div>
          <button id="authorCancel" class="btn">Cancel</button>
          <button id="authorConfirm" class="btn btn-primary">Confirm Payment</button>
        </div>
      </div>
    </div>

    <!-- Right Registration Form -->
    <div class="register-box">
      <h2>Register Now</h2>
      <form method="POST" action="/register">
        <label for="name">Name</label>
        <input type="text" id="name" name="name" required />

        <label for="email">Email Address</label>
        <input type="email" id="email" name="email" required />

        <label for="password">Password</label>
        <input type="password" id="password" name="password" required />

        <div class="form-bottom">
          <div class="remember">
            <input type="checkbox" id="remember" name="remember" />
            <label for="remember">Remember Me</label>
          </div>
          
          <button type="submit">Register</button>
        </div>
      </form>
    </div>

    <!-- Privacy & User Agreement Modal -->
    <div id="agreementModal" class="modal">
      <div class="modal-content">
        <h2>Before You Continue</h2>
        <p>Please read and accept our policies to proceed:</p>

        <div class="agreement-box">
          <label>
            <input type="checkbox" id="privacyCheck" />
            I agree to the <a href="/privacy" target="_blank">Privacy Policy</a>
          </label><br>
          <label>
            <input type="checkbox" id="termsCheck" />
            I agree to the <a href="/terms" target="_blank">User Agreement</a>
          </label>
        </div>

        <div class="agreement-actions">
          <button onclick="confirmAgreement()">Confirm</button>
          <button onclick="cancelAgreement()">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Modal -->
    <div id="errorModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h2>Duplicate Email Address</h2>
        <p>{{ error }}</p>
      </div>
    </div>
  </div>

<script>
(function() {
  const form = document.querySelector("form[action='/register']");
  const preRegisterModal = document.getElementById("preRegisterModal");
  const subscriberBtn = document.getElementById("subscriberBtn");
  const authorBtn = document.getElementById("authorBtn");

  const authorModal = document.getElementById("authorModal");
  const authorCancel = document.getElementById("authorCancel");
  const authorConfirm = document.getElementById("authorConfirm");

  const agreementModal = document.getElementById("agreementModal");
  const errorModal = document.getElementById("errorModal");

  window.closeModal = function() {
    errorModal.style.display = "none";
  };

  //Ensure preRegisterModal always shows first on page load
  window.addEventListener("DOMContentLoaded", () => {
    preRegisterModal.style.display = "flex"; // show role selection first
    authorModal.style.display = "none";
    agreementModal.style.display = "none";
  });

  // Utility to create/update hidden input for role
  function setRole(role) {
    let input = form.querySelector("input[name='role']");
    if (!input) {
      input = document.createElement("input");
      input.type = "hidden";
      input.name = "role";
      form.appendChild(input);
    }
    input.value = role;
  }

  //SUBSCRIBER: click "Join for FREE"
  subscriberBtn?.addEventListener("click", () => {
    setRole("Subscriber");
    preRegisterModal.style.display = "none"; // hide modal, go to form
  });

  //AUTHOR: click "Upgrade"
  authorBtn?.addEventListener("click", () => {
    preRegisterModal.style.display = "none";
    authorModal.style.display = "flex";
    authorModal.setAttribute("aria-hidden", "false");
  });

  //Cancel author payment
  authorCancel?.addEventListener("click", () => {
    authorModal.style.display = "none";
    authorModal.setAttribute("aria-hidden", "true");
    preRegisterModal.style.display = "flex"; // return to pre-register modal
  });

  //Confirm author payment
  authorConfirm?.addEventListener("click", () => {
    setRole("Author");
    authorModal.style.display = "none";
    // Now go to registration form with Author preselected
  });

  // Click outside author modal → close
  authorModal?.addEventListener("click", e => {
    if (e.target === authorModal) {
      authorModal.style.display = "none";
      preRegisterModal.style.display = "flex";
    }
  });

  // ESC key → close author modal
  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && authorModal.style.display === "flex") {
      authorModal.style.display = "none";
      preRegisterModal.style.display = "flex";
    }
  });

  //When user clicks "Register" → open Privacy Agreement modal
  form.addEventListener("submit", function(event) {
    event.preventDefault(); // stop form submission temporarily
    agreementModal.style.display = "flex"; // show user agreement
  });

  //Confirm user agreement → now submit the form
  window.confirmAgreement = function() {
    const privacy = document.getElementById("privacyCheck").checked;
    const terms = document.getElementById("termsCheck").checked;

    if (!privacy || !terms) {
      alert("Please agree to both the Privacy Policy and User Agreement before continuing.");
      return;
    }

    agreementModal.style.display = "none";
    form.submit(); // finally submit
  };

  //Cancel user agreement → close modal
  window.cancelAgreement = function() {
    agreementModal.style.display = "none";
  };

  //Show error modal if email already exists
  {% if error %}
    errorModal.style.display = "flex";
    document.querySelector("#errorModal p").textContent = "{{ error }}";
  {% endif %}

  // Click outside the modal closes it
  window.addEventListener("click", (e) => {
    if (e.target === errorModal) {
      errorModal.style.display = "none";
    }
  });

  // Pressing ESC closes the modal
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape" && errorModal.style.display === "block") {
      errorModal.style.display = "none";
    }
  });
})();
</script>
</body>
</html>


