<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>My Articles — EchoPress</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="{{ url_for('static', filename='img/favicon.png') }}" type="image/png" />
  <link rel="stylesheet" href="{{ url_for('static', filename='css/subscriber.css') }}">
</head>
<body>

  <!-- Top Bar -->
  <header class="topbar">
    <div class="left">
      <a href="{{ url_for('subscriberHomepage') }}" class="brand">
        <img src="{{ url_for('static', filename='img/echopresslogo.png') }}" alt="EchoPress" />
      </a>
      <div class="search">
        <input type="text" placeholder="Searching for… ?" aria-label="Search" />
        <button>Search</button>
      </div>
    </div>

    <div class="right">
      <span class="welcome">Welcome, {{ session.get('user','Subscriber') }} !</span>
      <button id="menuBtn" class="burger" aria-label="Menu"><span></span><span></span><span></span></button>
      <div id="menuPanel" class="menu-panel">
        <a href="{{ url_for('my_articles') }}" class="active">View My Articles</a>
        <a href="/bookmarks">View Bookmark</a>
        <a href="/analytics">View Analytics</a>
        <a href="/profile">Edit Profile</a>
        <a href="#" class="logout-link">Log Out</a>
      </div>
    </div>
  </header>

  <!-- Tabs (optional) -->
  <nav class="tabs">
    <div class="tabs-inner">
      <a href="#" class="tab">For you</a>
      <a href="#" class="tab active">Trending</a>
      <a href="#" class="tab">Politics</a>
      <a href="#" class="tab">Sports</a>
      <a href="#" class="tab">Technology</a>
      <a href="#" class="tab">Economic</a>
      <a href="#" class="tab">AsiaNews</a>
      <a href="#" class="tab">WorldNews</a>
    </div>
  </nav>

  <!-- Page -->
  <main class="page">

    <!-- LEFT: My Articles list -->
    <section class="feed">
      <div class="article-card detail">
        <div class="row-between" style="margin-bottom:12px;">
          <div class="card-header" style="margin:0;">My Articles</div>
          <div class="row-between" style="gap:10px;">
            <a class="btn btn-primary" href="{{ url_for('create_edit_delete_article') }}">Create New</a>
            <div class="sort-wrap">
              <select onchange="window.location.search='?sort='+this.value">
                <option value="">Sort by</option>
                <option value="recent"  {{ 'selected' if request.args.get('sort')=='recent'  else '' }}>Most Recent</option>
                <option value="title"   {{ 'selected' if request.args.get('sort')=='title'   else '' }}>Title (A–Z)</option>
                <option value="status"  {{ 'selected' if request.args.get('sort')=='status'  else '' }}>Status</option>
                <option value="category"{{ 'selected' if request.args.get('sort')=='category'else '' }}>Category</option>
              </select>
            </div>
          </div>
        </div>

        {% if not articles %}
          <p>No articles yet. <a href="{{ url_for('create_edit_delete_article') }}">Create one</a>.</p>
        {% else %}
          {% for a in articles %}
            {% set has_img = a.image_name %}
            {% if has_img %}
              {% set thumb = url_for('static', filename='uploads/' ~ a.image_name) %}
            {% endif %}

            <div class="list-item">
              <div class="item-info">
                <a href="{{ url_for('create_edit_delete_article') }}?edit={{ a.id }}" style="color:#000;text-decoration:none;">
                  <h3 class="item-title">{{ a.title }}</h3>
                </a>
                <p class="item-desc">
                  {{ (a.content or '')[:240] }}{% if (a.content or '')|length > 240 %}…{% endif %}
                </p>
                <div class="row-between">
                  <div class="item-meta">
                    <span class="pill">{{ a.category }}</span>
                    <span class="pill">{{ a.status|capitalize }}</span>
                  </div>
                  <div class="actions">
                    <a class="btn btn-light" href="{{ url_for('create_edit_delete_article') }}?edit={{ a.id }}">Edit</a>
                    <form method="post" action="{{ url_for('delete_article', aid=a.id) }}" onsubmit="return confirm('Delete this article?');">
                      <button class="btn btn-light" type="submit" style="border:1px solid #ccc;">Delete</button>
                    </form>
                  </div>
                </div>
              </div>

              {% if has_img %}
                <a href="{{ url_for('create_edit_delete_article') }}?edit={{ a.id }}" style="flex:0 0 220px;display:block;">
                  <img class="thumb" src="{{ thumb }}" alt="thumbnail">
                </a>
              {% else %}
                <div class="no-thumb">No Image</div>
              {% endif %}
            </div>
          {% endfor %}
        {% endif %}
      </div>
    </section>

    <!-- RIGHT: quick menu + Ads -->
    <aside class="sidebar">
      <div class="ads">Ads</div>
    </aside>

  </main>

  <!-- menu toggle -->
  <script>
    (function(){
      const btn=document.getElementById('menuBtn');
      const panel=document.getElementById('menuPanel');
      function closeP(){ panel.style.display='none'; }
      function toggleP(){ panel.style.display = panel.style.display==='block' ? 'none' : 'block'; }
      btn.addEventListener('click',e=>{ e.stopPropagation(); toggleP(); });
      document.addEventListener('click',e=>{ if(panel && !panel.contains(e.target) && e.target!==btn) closeP(); });
      document.addEventListener('keydown',e=>{ if(e.key==='Escape') closeP(); });
    })();
  </script>

  <!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal-overlay">
  <div class="modal">
    <h2>Log Out?</h2>
    <div class="buttons">
      <button class="yes" id="confirmLogout">Yes</button>
      <button class="no" id="cancelLogout">No</button>
    </div>
  </div>
</div>

<script>
  (function() {
    const modal = document.getElementById("logoutModal");
    const confirmBtn = document.getElementById("confirmLogout");
    const cancelBtn = document.getElementById("cancelLogout");

    // intercept logout links
    document.querySelectorAll(".logout-link").forEach(link => {
      link.addEventListener("click", e => {
        e.preventDefault();
        modal.style.display = "flex";
      });
    });

    confirmBtn.addEventListener("click", () => {
      window.location.href = "{{ url_for('logout') }}";
    });

    cancelBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    // close modal on Escape key
    document.addEventListener("keydown", e => {
      if (e.key === "Escape") modal.style.display = "none";
    });
  })();
</script>

</body>
</html>
